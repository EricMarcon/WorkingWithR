<!DOCTYPE html>
<html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>7 Shiny | Working with R</title>
<meta name="author" content="Eric Marcon">
<meta name="description" content="Shiny allows to publish an interactive application using R code as a web site. The site can run locally, on a user’s workstation that launches it from RStudio, or online, on a dedicated server...">
<meta name="generator" content="bookdown 0.36 with bs4_book()">
<meta property="og:title" content="7 Shiny | Working with R">
<meta property="og:type" content="book">
<meta property="og:url" content="https://ericmarcon.github.io/WorkingWithR/chap-shiny.html">
<meta property="og:description" content="Shiny allows to publish an interactive application using R code as a web site. The site can run locally, on a user’s workstation that launches it from RStudio, or online, on a dedicated server...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="7 Shiny | Working with R">
<meta name="twitter:description" content="Shiny allows to publish an interactive application using R code as a web site. The site can run locally, on a user’s workstation that launches it from RStudio, or online, on a dedicated server...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.5.1/transition.js"></script><script src="libs/bs3compat-0.5.1/tabs.js"></script><script src="libs/bs3compat-0.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script><link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="libs/vis-9.1.0/vis-network.min.js"></script><script src="libs/visNetwork-binding-2.1.2/visNetwork.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet">
<script src="libs/tabwid-1.1.3/tabwid.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-7NVD1TWMCJ"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-7NVD1TWMCJ');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Working with R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Presentation</a></li>
<li><a class="" href="chap-logiciels.html"><span class="header-section-number">1</span> Software</a></li>
<li><a class="" href="chap-utiliseR.html"><span class="header-section-number">2</span> Use R</a></li>
<li><a class="" href="chap-git.html"><span class="header-section-number">3</span> Git and GitHub</a></li>
<li><a class="" href="chap-rediger.html"><span class="header-section-number">4</span> Writing</a></li>
<li><a class="" href="chap-package.html"><span class="header-section-number">5</span> Package</a></li>
<li><a class="" href="chap-ci.html"><span class="header-section-number">6</span> Continuous integration</a></li>
<li><a class="active" href="chap-shiny.html"><span class="header-section-number">7</span> Shiny</a></li>
<li><a class="" href="chap-enseigner.html"><span class="header-section-number">8</span> Teaching with R</a></li>
<li><a class="" href="chap-conclusion.html"><span class="header-section-number">9</span> Conclusion</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/EricMarcon/WorkingWithR">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="chap-shiny" class="section level1" number="7">
<h1>
<span class="header-section-number">7</span> Shiny<a class="anchor" aria-label="anchor" href="#chap-shiny"><i class="fas fa-link"></i></a>
</h1>
<p>Shiny allows to publish an interactive application using R code as a web site.
The site can run locally, on a user’s workstation that launches it from RStudio, or online, on a dedicated server running Shiny Server<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://rstudio.com/products/shiny/download-server/" class="uri"&gt;https://rstudio.com/products/shiny/download-server/&lt;/a&gt;&lt;/p&gt;'><sup>112</sup></a>.</p>
<p>Basically, a form allows to enter the arguments of a function and a visualization window to display the results of the calculation.</p>
<p>A Shiny application makes the execution of the code very simple, even for users not familiar with R, but obviously limits the possibilities.</p>
<div id="first-application" class="section level2" number="7.1">
<h2>
<span class="header-section-number">7.1</span> First application<a class="anchor" aria-label="anchor" href="#first-application"><i class="fas fa-link"></i></a>
</h2>
<p>In RStudio, create an application with the menu “File &gt; New File &gt; Shiny Web App…”, enter the name of the application “MyShinyApp” and select the folder where to put it.</p>
<p>The name of the application has been used to create a folder that we now need to transform into a project (project menu in the top right of RStudio, “New Project &gt; Existing Directory”, select the application folder).</p>
<p>The application file named <code>app.R</code> contains two functions: <code>ui()</code> which defines the GUI and <code>server()</code> which contains the R code to be executed.
The application can be launched by clicking on <code>Run App</code> in the code window.</p>

<p></p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:shiny-geiser"></span>
<img src="images/shiny-geiser.png" alt="Shiny Application Old Faithful Geyser Data." width="80%"><p class="caption">
Figure 7.1: Shiny Application <em>Old Faithful Geyser Data</em>.
</p>
</div>
<p></p>
<p>The correspondence between the displayed window (figure <a href="chap-shiny.html#fig:shiny-geiser">7.1</a>) and the <code>ui()</code> function code is easy to see:</p>
<ul>
<li>The title of the application is displayed by the <code><a href="https://rdrr.io/pkg/shiny/man/titlePanel.html">titlePanel()</a></code> function.</li>
<li>The slider that sets the number of bars in the histogram is created by <code><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html">sliderInput()</a></code>.</li>
<li>The <code><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarLayout()</a></code> function sets the layout of the page elements, <code>sidebarPanel</code> for the input controls and <code><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">mainPanel()</a></code> for the result display.</li>
</ul>
<p>The result is displayed by the <code><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html">plotOutput()</a></code> function whose argument is the name of an element of <code>output</code>, the variable filled by the <code>server()</code> function.</p>
<p>Any modification of an element of the interface, precisely of an element displayed by a function whose name ends with <code>Input()</code> (there are some for all types of inputs, for example <code><a href="https://rdrr.io/pkg/shiny/man/textInput.html">textInput()</a></code>) of <strong>Shiny</strong> causes <code>server()</code> to be executed and the elements of <code>output</code> to be updated.</p>
</div>
<div id="more-elaborate-application" class="section level2" number="7.2">
<h2>
<span class="header-section-number">7.2</span> More elaborate application<a class="anchor" aria-label="anchor" href="#more-elaborate-application"><i class="fas fa-link"></i></a>
</h2>
<div id="working-method" class="section level3" number="7.2.1">
<h3>
<span class="header-section-number">7.2.1</span> Working method<a class="anchor" aria-label="anchor" href="#working-method"><i class="fas fa-link"></i></a>
</h3>
<p>An application is created by choosing:</p>
<ul>
<li>A window layout.</li>
<li>The controls for entering parameters (<em>intput</em>).</li>
<li>The controls for displaying the results (<em>output</em>).</li>
</ul>
<p>The code to process the inputs and produce the outputs is then written to <code>server()</code>.</p>
<p>The RStudio tutorial<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://shiny.rstudio.com/tutorial/" class="uri"&gt;https://shiny.rstudio.com/tutorial/&lt;/a&gt;&lt;/p&gt;'><sup>113</sup></a> is very detailed and should be used to go further.</p>
</div>
<div id="example" class="section level3" number="7.2.2">
<h3>
<span class="header-section-number">7.2.2</span> Example<a class="anchor" aria-label="anchor" href="#example"><i class="fas fa-link"></i></a>
</h3>
<p>This simple application uses the <strong>scholar</strong> package to query Google Scholar and get the bibliometric data of an author from his or her identifier.</p>
<p>The <code>app.R</code> file contains all the code and is built incrementally here.
The full application, with graphical output in addition to its simplified version presented here is available on GitHub<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://github.com/EricMarcon/bibliometrics" class="uri"&gt;https://github.com/EricMarcon/bibliometrics&lt;/a&gt;&lt;/p&gt;'><sup>114</sup></a>.</p>
<p>The beginning of the code consists of preparing the application to run by loading the necessary packages:</p>
<p></p>
<div class="sourceCode" id="cb475"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Prepare the application ####</span></span>
<span><span class="co"># Load packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://shiny.posit.co/">"shiny"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://tidyverse.tidyverse.org">"tidyverse"</a></span><span class="op">)</span></span></code></pre></div>
<p></p>
<p>The code of the complete application includes a function to install the missing packages, to be executed only when the application is executed on a workstation (on a server, the management of packages is not the responsibility of the application).</p>
<p>The user interface is as follows:</p>
<p></p>
<div class="sourceCode" id="cb476"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># UI ####</span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span></span>
<span>  <span class="co"># Application title</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/titlePanel.html">titlePanel</a></span><span class="op">(</span><span class="st">"Bibliometrics"</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarLayout</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarPanel</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/helpText.html">helpText</a></span><span class="op">(</span><span class="st">"Enter the Google Scholar ID of an author."</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/textInput.html">textInput</a></span><span class="op">(</span><span class="st">"AuthorID"</span>, <span class="st">"Google Scholar ID"</span>, <span class="st">"4iLBmbUAAAAJ"</span><span class="op">)</span>,</span>
<span>      <span class="co"># End of input</span></span>
<span>      <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">br</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      <span class="co"># Display author's name and h</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/htmlOutput.html">uiOutput</a></span><span class="op">(</span><span class="st">"name"</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/htmlOutput.html">uiOutput</a></span><span class="op">(</span><span class="st">"h"</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="co"># Show plots in the main panel</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">mainPanel</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html">plotOutput</a></span><span class="op">(</span><span class="st">"network"</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html">plotOutput</a></span><span class="op">(</span><span class="st">"citations"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p></p>
<p>The application window is fluid, i.e. it reorganizes itself when its size changes, and is composed of a side panel (for text input and display) and a main panel, for displaying graphics.</p>
<p>The elements of the side panel are:</p>
<ul>
<li>A help text: <code><a href="https://rdrr.io/pkg/shiny/man/helpText.html">helpText()</a></code>.</li>
<li>A text input field, <code><a href="https://rdrr.io/pkg/shiny/man/textInput.html">textInput()</a></code>, whose arguments are the name, the displayed text, and the default value (an author ID).</li>
<li>A line break: <code><a href="https://rstudio.github.io/htmltools/reference/builder.html">br()</a></code>.</li>
<li>HTML output controls: <code><a href="https://rdrr.io/pkg/shiny/man/htmlOutput.html">uiOutput()</a></code>, whose single argument is the name.</li>
</ul>
<p>The main panel contains two graphical output controls, <code><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html">plotOutput()</a></code> whose argument is also the name.</p>
<p>The code to execute to process the inputs and produce the outputs is in the <code>server()</code> function.</p>
<p></p>
<div class="sourceCode" id="cb477"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Server logic ####</span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Run the get_profile function only once ####</span></span>
<span>  <span class="co"># Store the author profile</span></span>
<span>  <span class="va">AuthorProfile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactiveVal.html">reactiveVal</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="co"># Update it when input$AuthorID is changed</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">AuthorID</span>, </span>
<span>               <span class="fu">AuthorProfile</span><span class="op">(</span><span class="fu">get_profile</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">AuthorID</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Output ####</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderUI.html">renderUI</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">h2</a></span><span class="op">(</span><span class="fu">AuthorProfile</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">name</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">h</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderUI.html">renderUI</a></span><span class="op">(</span><span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">a</a></span><span class="op">(</span>href <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span></span>
<span>        <span class="st">"https://scholar.google.com/citations?user="</span>, </span>
<span>        <span class="va">input</span><span class="op">$</span><span class="va">AuthorID</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"h index:"</span>, <span class="fu">AuthorProfile</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">h_index</span><span class="op">)</span>,</span>
<span>        target <span class="op">=</span> <span class="st">"_blank"</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">citations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html">renderPlot</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu">get_citation_history</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">AuthorID</span><span class="op">)</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">cites</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xend <span class="op">=</span> <span class="va">year</span>, yend <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>                   size <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                   color <span class="op">=</span></span>
<span>                     <span class="st">'darkgrey'</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span>, color <span class="op">=</span> <span class="st">'firebrick'</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Citations per year"</span>,</span>
<span>           caption <span class="op">=</span> <span class="st">"Source: Google Scholar"</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">network</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html">renderPlot</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_blank.html">geom_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p></p>
<p>The information needed for the output fields <code>$name</code> and <code>$h</code> (author’s name and h-index) is obtained by the <code>get_profile()</code> function of the <strong>scholar</strong> package.
This function queries the author’s Google Scholar web page and extracts the values from the result: this is a heavy processing, which is better executed only once rather than twice, in the <code><a href="https://rdrr.io/pkg/shiny/man/renderUI.html">renderUI()</a></code> functions in charge of computing the values of <code>output$h</code> and <code>output$name</code>.</p>
<p>The simplest code to do this would be as follows:</p>
<p></p>
<div class="sourceCode" id="cb478"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="co"># Run the get_profile function only once ####</span></span>
<span>  <span class="co"># Store the author profile</span></span>
<span>  <span class="va">AuthorProfile</span> <span class="op">&lt;-</span> <span class="fu">get_profile</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">AuthorID</span><span class="op">)</span></span></code></pre></div>
<p></p>
<p>The difficulty with programming a Shiny application is that any computation referring to an input interface element must be <em>reactive</em>.
If the latter code were executed, the following error message would appear:
“Operation not allowed without an active reactive context. (You tried to do something that can only be done from inside a reactive expression or observer.)”</p>
<p>In practice, the execution of the code is started by modifying an input control (here: <code>intput$AuthorID</code>).
The code referring to one of these controls must be permanently waiting for a modification: it must therefore be placed in particular functions like <code><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html">renderPlot()</a></code> in the <em>Old Faithful Geyser Data</em> application or <code><a href="https://rdrr.io/pkg/shiny/man/renderUI.html">renderUI()</a></code> here.
The following code would run without error:</p>
<p></p>
<div class="sourceCode" id="cb479"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Output ####</span></span>
<span><span class="va">output</span><span class="op">$</span><span class="va">name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderUI.html">renderUI</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">AuthorProfile</span> <span class="op">&lt;-</span> <span class="fu">get_profile</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">AuthorID</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">h2</a></span><span class="op">(</span><span class="va">AuthorProfile</span><span class="op">$</span><span class="va">name</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p></p>
<p>The call to the value of the <code>input$AuthorID</code> control does occur in a reactive function (but <code>get_profile()</code> would have to be used a second time in the calculation of <code>output$h</code>, which we want to avoid).
The function <code>h2(AuthorProfile$name)</code> produces HTML code, a level 2 title paragraph whose value is passed as an argument.</p>
<p>All functions whose names begin with <code>render</code> in the <strong>shiny</strong> package are reactive, and each is intended to produce a different type of output, for example text (<code><a href="https://rdrr.io/pkg/shiny/man/renderPrint.html">renderText()</a></code>) or HTML code (<code><a href="https://rdrr.io/pkg/shiny/man/renderUI.html">renderUI()</a></code>).</p>
<p>If code is needed to compute variables common to several output controls (<code>output$name</code> and <code>output$h</code>), it must itself be responsive.
Two functions are very useful:</p>
<ul>
<li>
<code><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent()</a></code> watches for changes in an input control and executes code when they occur.</li>
<li>
<code><a href="https://rdrr.io/pkg/shiny/man/reactiveVal.html">reactiveVal()</a></code> allows you to define a reactive variable, which will be modified by the <code><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent()</a></code> code and will in turn cause other reactive functions that use its value to execute.</li>
</ul>
<p>So the optimal code creates a reactive variable to store the result of the Google Scholar query in:</p>
<p></p>
<div class="sourceCode" id="cb480"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Store the author profile</span></span>
<span><span class="va">AuthorProfile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactiveVal.html">reactiveVal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p></p>
<p>The reactive variable is empty at this point.
Its use is then that of a function: <code>AuthorProfile(x)</code> assigns it the value <code>x</code> and <code>AuthorProfile()</code>, without arguments, returns its value.
The <code><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent()</a></code> function is triggered when <code>input$AuthorID</code> is modified and executes the code passed as the second argument, in this case the update of <code>AuthorProfile</code>.</p>
<p></p>
<div class="sourceCode" id="cb481"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Update it when input$AuthorID is changed</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">AuthorID</span>, <span class="fu">AuthorProfile</span><span class="op">(</span><span class="fu">get_profile</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">AuthorID</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p></p>
<p>Finally, the <code><a href="https://rdrr.io/pkg/shiny/man/renderUI.html">renderUI()</a></code> functions that provide output control values use the value of <code>AuthorProfile</code>:</p>
<p></p>
<div class="sourceCode" id="cb482"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Output ####</span></span>
<span><span class="va">output</span><span class="op">$</span><span class="va">name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderUI.html">renderUI</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">h2</a></span><span class="op">(</span><span class="fu">AuthorProfile</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">name</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p></p>
<p>Note the parentheses in <code>AuthorProfile()</code>, a reactive variable, as opposed to the <code>AuthorProfile$name</code> syntax for a classic variable.</p>
<p>The value of <code>output$h</code> is an internet link, <code>&lt;a href=...</code> in HTML, written by the <code><a href="https://rstudio.github.io/htmltools/reference/builder.html">a()</a></code> function of the <strong>htmltools</strong> package used by <code><a href="https://rdrr.io/pkg/shiny/man/renderUI.html">renderUI()</a></code>.</p>
<p></p>
<div class="sourceCode" id="cb483"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output</span><span class="op">$</span><span class="va">h</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderUI.html">renderUI</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html">a</a></span><span class="op">(</span>href <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"https://scholar.google.com/citations?user="</span>,</span>
<span>        <span class="va">input</span><span class="op">$</span><span class="va">AuthorID</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"h index:"</span>, <span class="fu">AuthorProfile</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">h_index</span><span class="op">)</span>,</span>
<span>        target <span class="op">=</span> <span class="st">"_blank"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p></p>
<p>The link is to the author’s Google Scholar page.
The value displayed is its h index.
The argument <code>target = "_blank"</code> indicates that the link should be opened in a new browser window.</p>
<p>The <code>output$citations</code> graph is created by the <code><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html">renderPlot()</a></code> reactive function.
The data provided by the <code>get_citation_history()</code> function of <strong>scholar</strong> (which queries the Google Scholar API) is processed by <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code>.</p>
<p>Finally, the <code>output$network</code> graph is an empty graph in this simplified version of the application.</p>
<p>The full application takes this code and adds error handling in case the author code does not exist on Google Scholar and the co-author network graph.</p>
</div>
</div>
<div id="sec:hebergement-shiny" class="section level2" number="7.3">
<h2>
<span class="header-section-number">7.3</span> Hosting<a class="anchor" aria-label="anchor" href="#sec:hebergement-shiny"><i class="fas fa-link"></i></a>
</h2>
<p>A Shiny application is not necessarily hosted by a web server: it can be run on users’ workstations if they have R.</p>
<p>For a wider use, a dedicated server is necessary.
Shinyapps.io<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://www.shinyapps.io/" class="uri"&gt;https://www.shinyapps.io/&lt;/a&gt;&lt;/p&gt;'><sup>115</sup></a> is a service from RStudio that allows to host 5 Shiny applications for free with a maximum uptime of 5 hours per month.</p>
<p>First of all, you have to open an account on the site, preferably with your GitHub identifiers.
To allow the management of online applications directly from RStudio, you must then install the <strong>rsconnect</strong> package and set it up:</p>
<p></p>
<div class="sourceCode" id="cb484"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rsconnect</span><span class="fu">::</span><span class="fu">setAccountInfo</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"prenom.nom"</span>, token <span class="op">=</span> <span class="st">"xxx"</span>,</span>
<span>    secret <span class="op">=</span> <span class="st">"&lt;SECRET&gt;"</span><span class="op">)</span></span></code></pre></div>
<p></p>
<p>The exact code, along with the username and token to use, are displayed on the Shinyapps.io homepage: click on “Show Secret”, copy the code and paste it into the RStudio console to run it.
A “Publish” button is available just to the right of the “Run App” button.
Click on it and validate the publication (figure <a href="chap-shiny.html#fig:shiny-publish">7.2</a>).</p>

<p></p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:shiny-publish"></span>
<img src="images/shiny-publish.png" alt="Publication of the Shiny application on Shinyapps.io." width="80%"><p class="caption">
Figure 7.2: Publication of the Shiny application on Shinyapps.io.
</p>
</div>
<p></p>
<p>The application is now available at <a href="https://firstname-lastname.shinyapps.io/MyShinyApp/" class="uri">https://firstname-lastname.shinyapps.io/MyShinyApp/</a></p>
<p>The “Bibliometrics” application does not work on Shinyapps.io because the way the <strong>Scholar</strong> package queries Google Scholar is not supported.
Most Shiny applications work without difficulty, as long as they don’t require complex networking features.</p>

</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="chap-ci.html"><span class="header-section-number">6</span> Continuous integration</a></div>
<div class="next"><a href="chap-enseigner.html"><span class="header-section-number">8</span> Teaching with R</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#chap-shiny"><span class="header-section-number">7</span> Shiny</a></li>
<li><a class="nav-link" href="#first-application"><span class="header-section-number">7.1</span> First application</a></li>
<li>
<a class="nav-link" href="#more-elaborate-application"><span class="header-section-number">7.2</span> More elaborate application</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#working-method"><span class="header-section-number">7.2.1</span> Working method</a></li>
<li><a class="nav-link" href="#example"><span class="header-section-number">7.2.2</span> Example</a></li>
</ul>
</li>
<li><a class="nav-link" href="#sec:hebergement-shiny"><span class="header-section-number">7.3</span> Hosting</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/EricMarcon/WorkingWithR/blob/master/07-Shiny.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/EricMarcon/WorkingWithR/edit/master/07-Shiny.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Working with R</strong>" was written by Eric Marcon. It was last built on 11/04/2023.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
